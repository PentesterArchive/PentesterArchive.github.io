---
title: Writeup - Inclusion Dockerlabs.
categories: [Writeup, webExploitation]
tags: [Path Traversal, Brute Force, SUID PrivEsc ,medium]
description: Writeup exploiting Path Traversal vulnerabilty and performing PE in a Linux system. 
---

Download vulnerable target machine: [Inclusion - Dockerlabs.es](https://mega.nz/file/AalG1ZoR#Fm9_h5l_LUDw4bSy2NniytGsLuSD4EA12gUJ5ofYTF4)


## Discovery 

### Ports scan
We see 2 open ports; 22 `ssh` and 80 `http`.
![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/1.png)

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/2.png)

Let's explore the web server and see what's in there.
![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/3.png)

### Fuzzing.
I just saw a typicall index page so i proceed to execute a directory fuzzing to see if there is something else in here.
![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/4.png)

We have the `shop` directory. Let's check it.
![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/5.png)

## Exploitation.
### Path Traversal.

> You can see how to execute the following attack in detail at [Local File Inclusion Attack.](https://pentesterarchive.github.io/posts/LocalFileInclusion(LFI)/#lfi-types-serialization-and-bypasses)
{: .prompt-tip }



The server is showing the next error message.

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/6.png)

This error message is asking us for an "archivo" (file). Let's try to use this parameter name in the url and try to show a file.

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/7.png)

We can read `/etc/passwd`, this means that we have found a `Path Traversal` vulnerability. 

I tried different ways to execute commands: `Log Poisoning`, `PHP wrappers` and `PHP filter Chain` but nothing worked.
Then i remembered that the `ssh` service was runing so I executed a brute force attack against it with the usernames extracted from `/etc/passwd`.

### SSH Brute Force Attack.
I used `hydra` to perform this attack and found the next credentials.

```bash
hydra -l <username> -P <passwordList> -t <threads> <RHost> <service>
```

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/9.png)

After finding the credentials it's time to access the system.
![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/10.png)

## Post Exploitation.
### Privilege Escalation.
I made manual and automatic enumeration with the use of `linpeas.sh` but I didn't see any possible way to elevate my privileges.

#### Passwords Brute Force Attack.
> You can check how to perform the next attack in [Privilege Escalation - Su Brute Force attack.](https://pentesterarchive.github.io/posts/suBruteForce/)
{: .prompt-tip }

My last idea was to brute force other system users found in `/etc/passwd`. To do so I used `scp` to send `rockyou.txt` via `ssh` to this system and execute the attack using this passwords dictionary.
![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/11.png)
_Runing the brute force script._

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/12.png)

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/13.png)

We have found the password for the user seller. Let's log in!

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/14.png)

#### SUID Privilege Escalation.
After gaining access to the new user, I performed a user enumeration back again and found that seller can use `/usr/bin/php` as root without specifying password.

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/15.png)

If we go to [gtfobins#php](https://gtfobins.github.io/gtfobins/php/#sudo) we can see how to procceed.

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/16.png)

![img-description](/assets/img/writeups/2024/dockerlabs/inclusion/17.png)


