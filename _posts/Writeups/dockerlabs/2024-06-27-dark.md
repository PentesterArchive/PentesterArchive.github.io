---
title: Writeup - Dark Dockerlabs.
categories: [Writeup, Pivoting, webExploitation]
tags: [SSRF, Pivoting, SUID PrivEsc, medium]
description: Writeup exploiting SSRF vulnerabilty, we do pivoting using Socat and SUID privilege escalation. 
---

Download vulnerable target machine: [Dark - Dockerlabs.es](https://mega.nz/file/Qft1jCjb#PlBLNl2jgetv_7jP9ycnsKnL4pabkeec55XWCXxbORk)

## Discovery.
### Ports scannig.
`nmap -p- -Pn -sS --min-rate 5000 --open <IpAdress>`
![img-description](/assets/img/writeups/2024/dockerlabs/dark/1.png)
_Open ports: 22, 80_

Version scan
![img-description](/assets/img/writeups/2024/dockerlabs/dark/2.png)


We can go to see what is the target hosting on port 80.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/3.png)

We can see a web application that asks for an URL. Let's try the functionality searching for `http://google.es`
![img-description](/assets/img/writeups/2024/dockerlabs/dark/4.png)
![img-description](/assets/img/writeups/2024/dockerlabs/dark/5.png)
In this type of web application we can try to exploit an SSRF attack, but before trying to exploit it let's finish our enumeration phase.

### Directory fuzzing.
In this step we can try to find hidden directorys in the web server. I like to use `ffuf`.
```bash 
ffuf -u <TargetURL/<FUZZ>> -w <wordlist> [OPTIONS]
```

We have found two new directories. Let's check them.

![img-description](/assets/img/writeups/2024/dockerlabs/dark/6.png)

![img-description](/assets/img/writeups/2024/dockerlabs/dark/7.png)
_/info directory._
We have found very interesting information in this directory. 
1. We have a name 'Toni', at this moment i remembered that service `ssh` it's open in port `22`, let's try to brute force it with the username 'Toni'. [SSH Brute Force](#ssh-brute-force).
2. We have a new Ip Adress `20.20.20.3`. We can not attack this ip because we don't have conectivity, but we can try to use the web functionality to attack it through an SSRF attack.


## Exploitation.

### SSRF.
We can use the web functionality to exploit a SSRF attack. First, let's try to see if this new target is hosting a web in port `80`:


![img-description](/assets/img/writeups/2024/dockerlabs/dark/9.png)

![img-description](/assets/img/writeups/2024/dockerlabs/dark/10.png)


Once here let's read the source code.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/13.5.png)

Reading the code I discovered that we can execute a command, `cmd`, so probably we can execute system commands from this web page.
I tried different techniques to execute `RCE` but nothing worked.

#### SSRF Reading files.
I couldn't do a `RCE` but another useful technique when we are facing a `SSRF` vulnerability is to __leak files__. Let's try to show the `/etc/passwd` file to enumerate usernames.
```
file://////etc/passwd
```
![img-description](/assets/img/writeups/2024/dockerlabs/dark/33.png)
![img-description](/assets/img/writeups/2024/dockerlabs/dark/34.png)

We see the username `toni`, the same user we saw before in the [discovery](#discovery) phase so let's move to the next exploitation vector, [ssh brute force attack](#ssh-brute-force).



### SSH Brute Force.
```bash
hydra -l toni -P <wordlists> <rHost> ssh
```
![img-description](/assets/img/writeups/2024/dockerlabs/dark/11.png)

We found a password. Let's access the ssh service.

![img-description](/assets/img/writeups/2024/dockerlabs/dark/12.png)

## Post Exploitation.
### Pivoting.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/35.png)<br />
Let's try now to execute commands in `20.20.20.3` from the exploited target.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/15.png)

As we can see we have `RCE`. Now we can try to obtain a shell in our Attacker machine.
To do it we need to use `socat` to perform port forwarding.

1. Sharing socat with `10.10.10.2`.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/16.png)

2. Now we have to open a new ssh connection in `10.10.10.2`.
    1. The first ssh session must run `socat` pointing to our local machine that has to be listening for the connection.
    2. The other ssh session must execute a `RCE`, we must make the target run `nc` via `curl`.


![img-description](/assets/img/writeups/2024/dockerlabs/dark/19.png)



> As we can see in the next picture the command was successful.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/18.png)


### Privilege Escalation
I runned `linpeas.sh` to analyze the target and perform a privilege escalation and I found the next `SUID`
![img-description](/assets/img/writeups/2024/dockerlabs/dark/20.png)

> If we go to [GTFOBins](https://gtfobins.github.io/gtfobins/curl/) we can see all the actions we can perform with `curl SUID`.
![img-description](/assets/img/writeups/2024/dockerlabs/dark/26.png)

I don't have read permissions on `/etc/shadow`, but using the previously mentioned technique we can __read the full file__:
![img-description](/assets/img/writeups/2024/dockerlabs/dark/22.png)


> Using this information we can perform two different Privilege Escalation techniques, you can study both of them visiting my Github profile: [Github - /etc/passwd manipulation Privilege Escalation.](https://github.com/PentesterArchive/Privilege-Escalation/blob/main/Linux/File%20Manipulation%20Privilege%20Escalation/etc-passwd.md)
{: .prompt-tip }


#### /etc/passwd Manipulation PE.
##### Creating a new user. 
We can copy the full `/etc/passwd` in another location, in my case I made it in `/tmp`. After that we can create a new user.



```bash
pentester::0:0:,,,:/:/bin/bash
```
![img-description](/assets/img/writeups/2024/dockerlabs/dark/23.png)



Once we have written our own `/etc/passwd` with a new root user with no password, we must replace the legitimate file for our new one using curl. 

```
curl "file:///<newFile>" -o "/etc/passwd"
```


![img-description](/assets/img/writeups/2024/dockerlabs/dark/24.png)

![img-description](/assets/img/writeups/2024/dockerlabs/dark/25.png)
_Checking if the file has been replaced._



![img-description](/assets/img/writeups/2024/dockerlabs/dark/27.png)
_Becoming root._

