---
title: Writeup - ica1 Vulnhub.
categories: [Writeup, webExploitation]
tags: [mysql, PathHijacking, easy]
description: In this Writeup we are going to get access to mysql and elevate our privileges via PathHijacking.
---

Download vulnerable target machine: [ica1 - Vulnhub](https://www.vulnhub.com/entry/ica-1,748/)


## Discovery.

### Port Scanning.
We must execute a port scanning to see which ports are opened.

![img-description](assets/img/writeups/2024/vulnhub/ica1/1.png)

__Opened ports:__
- 22 `ssh`.
- 80 `http`.
- 3306 `mysql`.
- 33060 `mysqlx`.

Now let's retrieve a bit of information about the services versions.

![img-description](assets/img/writeups/2024/vulnhub/ica1/2.png)

## Exploitation.
### Service version.
Let's access to the web server.
After trying different type of attacks in the login I saw the `qdPM` version and proceed to search for an exploit in `exploitdb`.
![img-description](assets/img/writeups/2024/vulnhub/ica1/3.png)

I saw this interesting exploit that retrieves us a password even if we are unauthenticated, let's read it and try the attack.

![img-description](assets/img/writeups/2024/vulnhub/ica1/4.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/5.png)
_Download the exploit_

![img-description](assets/img/writeups/2024/vulnhub/ica1/3.5.png)

This document shows us how can we obtain a password, let's follow the instructions.

![img-description](assets/img/writeups/2024/vulnhub/ica1/5.5.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/6.png)

Now we have the `database.yml` which contains the password let's read it.
![img-description](assets/img/writeups/2024/vulnhub/ica1/7.png)

### mysql. 
> You can check my github file to see how to use mysql [Github - SQL Basics.](https://github.com/PentesterArchive/Pentesting-Fundamentals-Skills-and-Techniques./tree/main/SQL%20Basics)
{: .prompt-tip }




We have database credentials. If we go back to [port scaning](#port-scanning) we can see that `mysql 3306` is opened. Let's try to connect there using this credentials.

![img-description](assets/img/writeups/2024/vulnhub/ica1/8.png)

We have access to the database! Let's show all the databases and explore them.


![img-description](assets/img/writeups/2024/vulnhub/ica1/9.png)

We have very interesting databases, I first explored `qpdm` database and I found very interesting columns as `password`. Sadly, this database was empty.

![img-description](assets/img/writeups/2024/vulnhub/ica1/13.png)

So let's move to the `staff` database.

![img-description](assets/img/writeups/2024/vulnhub/ica1/15.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/16.png)

We found __login__ info in this database too.

The passwords are `base64` encrypted. It's very easy to decrypt base64 using bash. 
Now it's time to decrypt and add the decrypted passwords in a file. We will write the usernames in another file to execute a ssh brute force attack via `hydra`.

![img-description](assets/img/writeups/2024/vulnhub/ica1/17.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/19.png)


### Hydra brute Force attack.
The target has `ssh` service running, which, if the attack is succesful, brings us full access to the target system. 
On the other hand, the web login asks for an email, which we don't have, that's why our attack is pointing to the ssh service.

```
hydra -L <usersList> -P <passwordList> -t <threads> <RHost> ssh
```


![img-description](assets/img/writeups/2024/vulnhub/ica1/20.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/21.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/22.png)

Credentials found! Let's use them to acces the system.



## Post Exploitation.

### Privilege Escalation.

#### System enumeration.
I loged in as both users to see what do each of them has access in the system.
I found two `.txt` files, let's read them.

![img-description](assets/img/writeups/2024/vulnhub/ica1/23.png)
_flag._

`note.txt` is very interesting, we have a clue to elevate our privileges written there.

![img-description](assets/img/writeups/2024/vulnhub/ica1/24.png)

> The contents of __executable files__ are partially viewable. I need to find out if there is a vulnerability or not.

Let's find out.

#### Path hijacking Privilege Escalation.

>You can visit the next file to see more about the technique we are going to use from now on. [Path Hijacking.](https://pentesterarchive.github.io/posts/pathHijacking/)
{: .prompt-info }


First of all we are going to search for `SUID` bynaries. 

```
find / -perm -4000 2>/dev/null
```

![img-description](assets/img/writeups/2024/vulnhub/ica1/25.png)

We have an interesting binary in `opt` directory. Let's execute it and try to understand his functionallity.



![img-description](assets/img/writeups/2024/vulnhub/ica1/26.png)

![img-description](assets/img/writeups/2024/vulnhub/ica1/27.png)


As we saw in the last picture `get_access` is an `ELF` file. If we obtain the commands that the binary is executing we can perform a `Path Hijacking Privilege Escalation Attack`.

Using the command `strings` we can obtain the commands being executed by the binary.
```
strings get_access
```

![img-description](assets/img/writeups/2024/vulnhub/ica1/28.png)

We see cat, let's try to perform the Path Hijacking privilege escalation.


![img-description](assets/img/writeups/2024/vulnhub/ica1/29.png)
_Obtaining the current $PATH_

![img-description](assets/img/writeups/2024/vulnhub/ica1/30.png)
_Making the $PATH point to /tmp where we will write our own cat file._

_Don't forget to add execution permissions to `/tmp/cat`_

![img-description](assets/img/writeups/2024/vulnhub/ica1/31.png)

Finally, we are going to execute the binary and obtain root privileges.
![img-description](assets/img/writeups/2024/vulnhub/ica1/32.png)


